# Overview
This is all of the design files and the code needed for my precision current source. The code for the microcontroller was made using the Arduino framework and PlatformIO so it's easy to modify and can be re-flashed with another Arduino, or over the USB interface once the bootloader is burned. The serial interface features a few basic commands for setting the current and reading it back using the onboard ADC, as well as reading the internal temperature sensors. I added a lot of error checking to the firmware so it should be basically impossible to make the device do something that it shouldn't, and give the user feedback if their inputs are accepted or not. This design uses an external voltage source up to 100 volts, so it can be used with relatively high resistance loads. It is also suitable for high inductance loads, and has been verified stable into 250 mH.

# Stability Measurement
Since this is meant to be used for driving gradient and shim coils for long experimental runs, temperature stability is critical. To measure the stability I rented a Keysight 3458A and logged data for a week at maximum output current and the result can be seen in the plot below. Allan deviations for this data are also shown. The current stability could be further improved by using a different voltage reference, the LTZ1000A or LM399 for example, but these would come with a significant accuracy penalty. Of course the accuracy can be calibrated in software, but that requires the user to have a very good DMM and makes the assembly process more complicated. I tried to balance initial accuracy and temperature stability as much as possible.

![stability](https://github.com/user-attachments/assets/0c841162-d0d3-4aff-b783-4f881fc1e3cc)
![adevs](https://github.com/user-attachments/assets/ae9102fe-52ee-4cb9-8865-a3c8f8de0e02)

# Serial Interface
When the device is connected to the computer it should show up as a COM port in windows and a ttyUSB device on Linux. On Linux the device will need to be chmodded in order to connect to it using pyserial. Usually the FTDI drivers automatically download or are already installed, but if not they can be downloaded [here](https://ftdichip.com/drivers/vcp-drivers/). The interface uses eight data bits, no parity, and one stop bit at 115200 baud. On powerup the device does some self checks and looks to see if the optional tmp117 temperature sensor is present. After connecting to the serial interface two readlines need to be done, the first says whether the tmp117 is detected or not, and the second is for any detected errors. If the device detects no errors the second readline will return "Ready." 
